(function(e){function t(t){for(var r,o,u=t[0],c=t[1],l=t[2],d=0,f=[];d<u.length;d++)o=u[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);s&&s(t);while(f.length)f.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,u=1;u<n.length;u++){var c=n[u];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={index:0},i=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],c=u.push.bind(u);u.push=t,u=u.slice();for(var l=0;l<u.length;l++)t(u[l]);var s=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("fe8f")},1101:function(e,t,n){"use strict";n("200d")},"200d":function(e,t,n){},"6dbb":function(e,t,n){"use strict";n("ef87")},"744a":function(e,t,n){},ddae:function(e,t,n){"use strict";n("744a")},ef87:function(e,t,n){},fe8f:function(e,t,n){"use strict";n.r(t);var r=n("7a23"),a=Object(r["g"])("div",{class:"editor",contenteditable:""},null,-1),i={key:0},o={key:1,class:"list-item"},u={key:2,class:"list-item"},c=["src"];function l(e,t,n,l,s,d){var f=Object(r["o"])("vue3-at");return Object(r["k"])(),Object(r["d"])(f,{atMap:e.atMap,onAt:e.onAt,renderTagItem:e.renderTagItem},{listItem:Object(r["r"])((function(e){var t=e.item;return[t.isSubjectTitle?(Object(r["k"])(),Object(r["f"])("div",i,Object(r["p"])(t.title),1)):t.tag?(Object(r["k"])(),Object(r["f"])("div",o,Object(r["p"])(t.tag),1)):(Object(r["k"])(),Object(r["f"])("div",u,[Object(r["g"])("img",{src:t.avatar,alt:""},null,8,c),Object(r["h"])(Object(r["p"])(t.name),1)]))]})),default:Object(r["r"])((function(){return[a]})),_:1},8,["atMap","onAt","renderTagItem"])}function s(e,t,n,a,i,o){var u=Object(r["o"])("AtList");return Object(r["k"])(),Object(r["f"])("div",{class:"at-wrapper",onCompositionstart:t[1]||(t[1]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.onCompositionStart&&e.onCompositionStart.apply(e,t)}),onCompositionend:t[2]||(t[2]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.onCompositionEnd&&e.onCompositionEnd.apply(e,t)}),onKeydownCapture:t[3]||(t[3]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.onKeyDown&&e.onKeyDown.apply(e,t)}),onInput:t[4]||(t[4]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.onInput&&e.onInput.apply(e,t)})},[Object(r["n"])(e.$slots,"default"),e.atListVisible?(Object(r["k"])(),Object(r["d"])(u,{key:0,list:e.matchedAtList,curIndex:e.curIndex,"onUpdate:curIndex":t[0]||(t[0]=function(t){return e.curIndex=t}),class:"at-list",onClickItem:e.onClickItem},{default:Object(r["r"])((function(t){var n=t.item,a=t.index;return[Object(r["n"])(e.$slots,"listItem",{item:n,index:a})]})),_:3},8,["list","curIndex","onClickItem"])):Object(r["e"])("",!0)],32)}var d,f=n("9ab4");function p(){var e=window.getSelection();if(e&&e.rangeCount>0)return e.getRangeAt(0)}function b(){var e=p();if(e){var t=e.cloneRange();return t.collapse(!0),t.setStart(t.endContainer,0),t}}function v(e){var t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}function m(e){return e.nodeType===Node.TEXT_NODE}function j(e){var t=e.endContainer.parentElement;if(!t)return!1;if(t.getAttribute("is-tag"))return t;var n=t.parentElement;return!!n&&(!!n.getAttribute("is-tag")&&n)}(function(e){e[e["up"]=38]="up",e[e["down"]=40]="down",e[e["enter"]=13]="enter",e[e["esc"]=27]="esc",e[e["left"]=37]="left",e[e["right"]=39]="right",e[e["delete"]=8]="delete"})(d||(d={}));var g={class:"at-list"},O=["onClick","onMouseenter"],y={key:1,class:"at-list__subject-title"};function h(e,t,n,a,i,o){return Object(r["k"])(),Object(r["f"])("div",g,[(Object(r["k"])(!0),Object(r["f"])(r["a"],null,Object(r["m"])(e.list,(function(t,n){return Object(r["k"])(),Object(r["f"])(r["a"],{key:n},[t.isSubjectTitle?(Object(r["k"])(),Object(r["f"])("div",y,[Object(r["n"])(e.$slots,"default",{item:t,index:n,curIndex:e.curIndex},(function(){return[Object(r["h"])(Object(r["p"])(t.title),1)]}))])):(Object(r["k"])(),Object(r["f"])("div",{key:0,class:Object(r["j"])(["at-list__item",{"at-list__item--active":n===e.curIndex}]),onClick:function(n){return e.$emit("click-item",t)},onMouseenter:function(t){return e.onMouseEnter(n)}},[Object(r["n"])(e.$slots,"default",{item:t,index:n,curIndex:e.curIndex},(function(){return[Object(r["h"])(Object(r["p"])(t),1)]}))],42,O))],64)})),128))])}var k=Object(r["i"])({name:"AtList",emits:["update:curIndex","click-item"],props:{showSubjectTitle:{type:Boolean,default:!0},list:{type:Array,required:!0},curIndex:{type:Number,required:!0}},setup:function(e,t){return{onMouseEnter:function(e){t.emit("update:curIndex",e)}}}}),I=(n("6dbb"),n("6b0d")),C=n.n(I),x=C()(k,[["render",h]]),S=Object(r["i"])({name:"App",components:{AtList:x},props:{atMap:{type:Object,default:function(){return{}}},renderTagItem:{type:Function,required:!1},disabledModifyTag:{type:Boolean,default:!0},showSubjectTitle:{type:Boolean,default:!0},allowSpaces:{type:Boolean,default:!1},filtersFn:{type:Function,default:function(e,t,n){return!(n&&!e.isSubjectTitle)||e[n].toLowerCase().includes(t.toLowerCase())}}},emits:["at","insert-tag","click-list-item","input"],setup:function(e,t){var n,a=Object(r["l"])(!1),i=Object(r["b"])((function(){return Object.keys(e.atMap)})),o=function(e){for(var t=0;t<i.value.length;t++){var n=e.indexOf(i.value[t]);if(-1!==n)return{at:i.value[t],index:n}}return!1},u=Object(r["l"])(1),c=!1,l=Object(r["l"])([]),s=function(e,t){t.deleteContents();var n=t.endContainer;if(m(n)){var r=t.endOffset;n.data=n.data.slice(0,r)+e+n.data.slice(r),t.setEnd(n,r+e.length)}else{var a=document.createTextNode(e);t.insertNode(a),t.setEndAfter(a)}t.collapse(!1),v(t)},p=function(e){document.execCommand("insertHTML",!1,'<span is-tag="true">'+e+"</span> ")},g="",O=-1,y=function(r){if(n){var a=n.cloneRange();if(-1!==O){if(a.setStart(a.endContainer,O),v(a),e.renderTagItem){var i=e.renderTagItem(r);i&&p(i)}else{var o=r[e.atMap[g].keyName];s(g+o,a)}t.emit("insert-tag",r)}}},h=function(e){if(a.value){var t=e===d.up?-1:1,n=u.value+t;n=Math.min(Math.max(n,0),l.value.length-1);while(l.value[n]&&l.value[n].isSubjectTitle)n+=t,n<0&&(n+=2);u.value=n}},k="",I=function(){var t=k?e.atMap[g].list.filter((function(t){return e.filtersFn(t,k,e.atMap[g].keyName)})):Object(f["a"])(e.atMap[g].list);t.length>0?(a.value=!0,l.value=Object(f["a"])(t)):a.value=!1};return Object(r["q"])(e.atMap,(function(){I()})),{atListVisible:a,matchedAtList:l,curIndex:u,onCompositionStart:function(){c=!0},onCompositionEnd:function(){c=!1},onKeyDown:function(t){if(!t.isComposing){var n=function(){if(e.disabledModifyTag){var n=b();if(n&&(t.key.length<=1||t.keyCode===d.enter||t.keyCode===d.delete)){var r=j(n);if(r){var a=document.getSelection();if(a){if(t.keyCode===d.delete){if(0===n.endOffset)return;return n.selectNode(r),a.removeAllRanges(),a.addRange(n),void document.execCommand("delete")}var i=document.createTextNode(" ");0===n.endOffset?r.parentElement&&r.parentElement.insertBefore(i,r):(r.nextSibling?r.parentElement.insertBefore(i,r.nextSibling):r.parentElement.append(i),n.setStart(i,1),a.removeAllRanges(),a.addRange(n))}}}}};if(n(),a.value)return t.keyCode===d.enter?(l.value[u.value]&&y(l.value[u.value]),a.value=!1,t.preventDefault(),void t.stopPropagation()):t.keyCode===d.up||t.keyCode===d.down?(h(t.keyCode),t.preventDefault(),void t.stopPropagation()):void 0}},onInput:function(){if(t.emit("input"),!c){var r=b();if(r){var i=j(r);if(!i){n=r.cloneRange();var u=r.toString(),l=o(u);l?(O=l.index,g=l.at,k=u.slice(O+g.length),e.allowSpaces||!/\s/.test(k)?(t.emit("at",{at:g,inputChunk:k}),I()):a.value=!1):a.value=!1}}}},onClickItem:function(e){t.emit("click-list-item",e),y(e)}}}}),w=(n("1101"),C()(S,[["render",s]])),A=Object(r["i"])({name:"App",components:{Vue3At:w},setup:function(){var e=Object(r["l"])({"@":{keyName:"name",list:[{isSubjectTitle:!0,title:"最近联系人"},{name:"SHISME",userId:"",avatar:"https://avatars.githubusercontent.com/u/17661313?s=40&v=4"},{name:"CAYAHUANG",userId:"",avatar:"https://avatars.githubusercontent.com/u/18247969?s=100&v=4"},{isSubjectTitle:!0,title:"好友"},{name:"OuYang",userId:"",avatar:"https://avatars.githubusercontent.com/u/13029538?s=100&v=4"},{name:"SAGA",avatar:"https://avatars.githubusercontent.com/u/16740021?s=100&v=4",userId:""}]},"#":{keyName:"tag",list:[{tag:"666"}]}});return{atMap:e,onAt:function(e){var t=e.at,n=e.inputChunk;console.log("onAt:",t,n)},renderTagItem:function(e){return e.tag?'<span style="color: deepskyblue">'+e.tag+"</span>":'<span style="color:#003569;" data-user-id="'+e.userId+'">@'+e.name+"</span>"}}}}),M=(n("ddae"),C()(A,[["render",l]]));Object(r["c"])(M).mount("#app")}});
//# sourceMappingURL=index.93fc137e.js.map